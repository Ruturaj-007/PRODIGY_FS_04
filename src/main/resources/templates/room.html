<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="'Chat Room - ' + ${roomId}">Chat Room</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body class="chat-page">
<!-- Chat Container -->
<div class="chat-container">
    <!-- Sidebar -->
    <aside class="chat-sidebar">
        <div class="sidebar-header">
            <h2>Room Info</h2>
        </div>

        <div class="room-details">
            <div class="detail-item">
                <span class="detail-label">Room ID:</span>
                <span class="detail-value room-id-display" th:text="${roomId}">room-123</span>
            </div>
            <div class="detail-item">
                <span class="detail-label">Your Name:</span>
                <span class="detail-value" th:text="${username}">Anonymous</span>
            </div>
        </div>

        <div class="online-users">
            <h3>Online Users</h3>
            <div id="users-list">
                <div class="user-item">
                    <div class="user-status online"></div>
                    <span th:text="${username}">You</span>
                </div>
            </div>
        </div>

        <button class="btn btn-secondary" id="leave-room-btn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                <polyline points="16 17 21 12 16 7"/>
                <line x1="21" y1="12" x2="9" y2="12"/>
            </svg>
            Leave Room
        </button>
    </aside>

    <!-- Main Chat Area -->
    <main class="chat-main">
        <!-- Chat Header -->
        <header class="chat-header">
            <div class="header-left">
                <h1 th:text="'# ' + ${roomId}">Room</h1>
                <span class="connection-status" id="connection-status">
                        <span class="status-dot"></span>
                        Connecting...
                    </span>
            </div>
            <div class="header-right">
                <button class="icon-btn" id="info-btn" title="Room Info">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="12" y1="16" x2="12" y2="12"/>
                        <line x1="12" y1="8" x2="12.01" y2="8"/>
                    </svg>
                </button>
            </div>
        </header>

        <!-- Messages Area -->
        <div class="messages-container" id="messages-container">
            <div class="messages-wrapper" id="messages">
                <!-- Welcome message -->
                <div class="system-message">
                    <p>Welcome to <strong th:text="${roomId}">this room</strong>! Start chatting below.</p>
                </div>
            </div>

            <!-- Typing Indicator -->
            <div class="typing-indicator" id="typing-indicator" style="display: none;">
                <span class="typing-text"></span>
                <span class="typing-dots">
                        <span></span><span></span><span></span>
                    </span>
            </div>
        </div>

        <!-- Message Input -->
        <div class="message-input-container">
            <form id="message-form">
                <div class="input-wrapper">
                    <input
                            type="text"
                            id="message-input"
                            placeholder="Type a message..."
                            autocomplete="off"
                            maxlength="2000"
                    >
                    <button type="submit" class="send-btn" id="send-btn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <line x1="22" y1="2" x2="11" y2="13"/>
                            <polygon points="22 2 15 22 11 13 2 9 22 2"/>
                        </svg>
                    </button>
                </div>
                <div class="input-info">
                    <span id="char-count">0/2000</span>
                </div>
            </form>
        </div>
    </main>
</div>

<!-- Hidden data for JavaScript -->
<input type="hidden" id="room-id" th:value="${roomId}">
<input type="hidden" id="username-data" th:value="${username}">

<!-- Include SockJS and STOMP -->
<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>

<!-- Custom Chat JavaScript -->
<script th:src="@{/js/chat.js}"></script>
</body>
</html>